!function(e,t){"object"==typeof exports&&typeof module<"u"?t(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],t):t((e=typeof globalThis<"u"?globalThis:e||self)["leaflet-control-geocoder"]={},e.L)}(this,function(e,t){"use strict";var o=Object.defineProperty,s=(e,t,s)=>((e,t,s)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);const a=function(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const o in e){var s;"default"!==o&&(s=Object.getOwnPropertyDescriptor(e,o),Object.defineProperty(t,o,s.get?s:{enumerable:!0,get:()=>e[o]}))}return t.default=e,Object.freeze(t)}(t);function i(e,t){return Object.assign(t,e.geocodingQueryParams)}function n(e,t){return Object.assign(t,e.reverseQueryParams)}const r=/[&<>"'`]/g,l=/[&<>"'`]/,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function p(e){return c[e]}function d(e,t){const s=new URL(e);return Object.entries(t).forEach(([t,e])=>{(Array.isArray(e)?e:[e]).forEach(e=>{s.searchParams.append(t,e)})}),fetch(s.toString(),{headers:{Accept:"application/json"}}).then(e=>e.json())}function u(e,o){return e.replace(/\{ *([\w_]+) *\}/g,(e,t)=>{let s=o[t];return void 0===s?s="":"function"==typeof s&&(s=s(o)),null==(t=s)?"":t?(t=""+t,l.test(t)?t.replace(r,p):t):t+""})}class h{constructor(e){s(this,"options",{serviceUrl:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",apiKey:""}),a.Util.setOptions(this,e)}async geocode(e){e=i(this.options,{token:this.options.apiKey,SingleLine:e,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"});return(await d(this.options.serviceUrl+"/findAddressCandidates",e)).candidates.map(e=>{var t=new a.LatLng(e.location.y,e.location.x),s=new a.LatLngBounds(new a.LatLng(e.extent.ymax,e.extent.xmax),new a.LatLng(e.extent.ymin,e.extent.xmin));return{name:e.address,bbox:s,center:t}})}suggest(e){return this.geocode(e)}async reverse(e,t){e=n(this.options,{location:e.lng+","+e.lat,distance:100,f:"json"}),e=await d(this.options.serviceUrl+"/reverseGeocode",e);if(!e||e.error)return[];var s=new a.LatLng(e.location.y,e.location.x),o=new a.LatLngBounds(s,s);return[{name:e.address.Match_addr,center:s,bbox:o}]}}class g{constructor(e){s(this,"options",{serviceUrl:"https://dev.virtualearth.net/REST/v1/Locations/"}),a.Util.setOptions(this,e)}async geocode(e){e=i(this.options,{query:e,key:this.options.apiKey}),e=await d(this.options.serviceUrl,e);return this._parseResults(e)}async reverse(e,t){var s=n(this.options,{key:this.options.apiKey}),e=await d(this.options.serviceUrl+e.lat+","+e.lng,s);return this._parseResults(e)}_parseResults(e){return e.resourceSets[0].resources.map(e=>{var t=e.bbox;return{name:e.name,bbox:new a.LatLngBounds([t[0],t[1]],[t[2],t[3]]),center:new a.LatLng(...e.point.coordinates)}})}}class m{constructor(e){if(s(this,"options",{apiKey:"",serviceUrl:"https://atlas.microsoft.com/search"}),a.Util.setOptions(this,e),!this.options.apiKey)throw new Error("Azure Maps Geocoder requires an API key.")}async geocode(e){e={"api-version":"1.0",query:e,"subscription-key":this.options.apiKey};return((await d(this.options.serviceUrl+"/address/json",e)).results||[]).map(e=>({name:e.address.freeformAddress,bbox:new a.LatLngBounds([e.viewport.topLeftPoint.lat,e.viewport.topLeftPoint.lon],[e.viewport.btmRightPoint.lat,e.viewport.btmRightPoint.lon]),center:new a.LatLng(e.position.lat,e.position.lon)}))}async reverse(t,e){var s={"api-version":"1.0",query:t.lat+","+t.lng,"subscription-key":this.options.apiKey};return((await d(this.options.serviceUrl+"/address/reverse/json",s)).addresses||[]).map(e=>({name:e.address.freeformAddress,bbox:new a.LatLngBounds([e.viewport.topLeftPoint.lat,e.viewport.topLeftPoint.lon],[e.viewport.btmRightPoint.lat,e.viewport.btmRightPoint.lon]),center:new a.LatLng(t.lat,t.lng)}))}}class v{constructor(e){s(this,"options",{serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json"}),a.Util.setOptions(this,e)}async geocode(e){e=i(this.options,{key:this.options.apiKey,address:e}),e=await d(this.options.serviceUrl,e);return this._parseResults(e)}async reverse(e,t){e=n(this.options,{key:this.options.apiKey,latlng:e.lat+","+e.lng}),e=await d(this.options.serviceUrl,e);return this._parseResults(e)}_parseResults(e){return null==(e=e.results||[])?void 0:e.map(e=>{var t=new a.LatLng(e.geometry.location.lat,e.geometry.location.lng),s=new a.LatLngBounds(new a.LatLng(e.geometry.viewport.northeast.lat,e.geometry.viewport.northeast.lng),new a.LatLng(e.geometry.viewport.southwest.lat,e.geometry.viewport.southwest.lng));return{name:e.formatted_address,bbox:s,center:t,properties:e.address_components}})}}class L{constructor(e){if(s(this,"options",{serviceUrl:"https://geocoder.api.here.com/6.2/",app_id:"",app_code:"",apiKey:"",maxResults:5}),a.Util.setOptions(this,e),null!=e&&e.apiKey)throw Error("apiKey is not supported, use app_id/app_code instead!")}geocode(e){e=i(this.options,{searchtext:e,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1,maxresults:this.options.maxResults});return this.getJSON(this.options.serviceUrl+"geocode.json",e)}reverse(e,t){let s=e.lat+","+e.lng;this.options.reverseGeocodeProxRadius&&(s+=","+this.options.reverseGeocodeProxRadius);e=n(this.options,{prox:s,mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1,maxresults:this.options.maxResults});return this.getJSON(this.options.serviceUrl+"reversegeocode.json",e)}async getJSON(e,t){return((null==(t=null==(e=(await d(e,t)).response.view)?void 0:e[0])?void 0:t.result)||[]).map(e=>{var e=e.location,t=new a.LatLng(e.displayPosition.latitude,e.displayPosition.longitude),s=new a.LatLngBounds(new a.LatLng(e.mapView.topLeft.latitude,e.mapView.topLeft.longitude),new a.LatLng(e.mapView.bottomRight.latitude,e.mapView.bottomRight.longitude));return{name:e.address.label,properties:e.address,bbox:s,center:t}})}}class w{constructor(e){s(this,"options",{serviceUrl:"https://geocode.search.hereapi.com/v1",apiKey:"",app_id:"",app_code:"",maxResults:10}),a.Util.setOptions(this,e)}geocode(e){e=i(this.options,{q:e,apiKey:this.options.apiKey,limit:this.options.maxResults});if(e.at||e.in)return this.getJSON(this.options.serviceUrl+"/discover",e);throw Error("at / in parameters not found. Please define coordinates (at=latitude,longitude) or other (in) in your geocodingQueryParams.")}reverse(e,t){e=n(this.options,{at:e.lat+","+e.lng,limit:this.options.reverseGeocodeProxRadius,apiKey:this.options.apiKey});return this.getJSON(this.options.serviceUrl+"/revgeocode",e)}async getJSON(e,t){return((await d(e,t)).items||[]).map(e=>{var t=new a.LatLng(e.position.lat,e.position.lng);let s;return s=e.mapView?new a.LatLngBounds(new a.LatLng(e.mapView.south,e.mapView.west),new a.LatLng(e.mapView.north,e.mapView.east)):new a.LatLngBounds(new a.LatLng(e.position.lat,e.position.lng),new a.LatLng(e.position.lat,e.position.lng)),{name:e.address.label,properties:e.address,bbox:s,center:t}})}}function _(e){let t;return(t=e.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))?new a.LatLng((/N/i.test(t[1])?1:-1)*+t[2],(/E/i.test(t[3])?1:-1)*+t[4]):(t=e.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))?new a.LatLng((/N/i.test(t[2])?1:-1)*+t[1],(/E/i.test(t[4])?1:-1)*+t[3]):(t=e.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?$/))?new a.LatLng((/N/i.test(t[1])?1:-1)*(+t[2]+ +t[3]/60),(/E/i.test(t[4])?1:-1)*(+t[5]+ +t[6]/60)):(t=e.match(/^(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([NS])\W*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([EW])$/))?new a.LatLng((/N/i.test(t[3])?1:-1)*(+t[1]+ +t[2]/60),(/E/i.test(t[6])?1:-1)*(+t[4]+ +t[5]/60)):(t=e.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?$/))?new a.LatLng((/N/i.test(t[1])?1:-1)*(+t[2]+ +t[3]/60+ +t[4]/3600),(/E/i.test(t[5])?1:-1)*(+t[6]+ +t[7]/60+ +t[8]/3600)):(t=e.match(/^(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]\s*([NS])\W*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\s*([EW])$/))?new a.LatLng((/N/i.test(t[4])?1:-1)*(+t[1]+ +t[2]/60+ +t[3]/3600),(/E/i.test(t[8])?1:-1)*(+t[5]+ +t[6]/60+ +t[7]/3600)):(t=e.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))?new a.LatLng(+t[1],+t[2]):void 0}class y{constructor(e){s(this,"options",{next:void 0,sizeInMeters:1e4}),a.Util.setOptions(this,e)}async geocode(e){const t=_(e);return t?[{name:e,center:t,bbox:t.toBounds(this.options.sizeInMeters)}]:this.options.next?this.options.next.geocode(e):[]}}class b{constructor(e){s(this,"options",{serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/"}),a.Util.setOptions(this,e)}_getProperties(e){const s={text:e.text,address:e.address};return(e.context||[]).forEach(e=>{var t=e.id.split(".")[0];s[t]=e.text,e.short_code&&(s.countryShortCode=e.short_code)}),s}async geocode(e){const t=this.options.serviceUrl+encodeURIComponent(e)+".json",s=i(this.options,{access_token:this.options.apiKey});void 0!==s.proximity&&void 0!==s.proximity.lat&&void 0!==s.proximity.lng&&(s.proximity=s.proximity.lng+","+s.proximity.lat);e=await d(t,s);return this._parseResults(e)}suggest(e){return this.geocode(e)}async reverse(e,t){e=await d(this.options.serviceUrl+e.lng+","+e.lat+".json",n(this.options,{access_token:this.options.apiKey}));return this._parseResults(e)}_parseResults(e){var t;return null!=(t=e.features)&&t.length?e.features.map(e=>{var t=new a.LatLng(...e.center.reverse());let s;return s=e.bbox?new a.LatLngBounds(new a.LatLng(...e.bbox.slice(0,2).reverse()),new a.LatLng(...e.bbox.slice(2,4).reverse())):new a.LatLngBounds(t,t),{name:e.place_name,bbox:s,center:t,properties:this._getProperties(e)}}):[]}}class f{constructor(e){s(this,"options",{serviceUrl:"https://www.mapquestapi.com/geocoding/v1"}),a.Util.setOptions(this,e),this.options.apiKey=decodeURIComponent(this.options.apiKey)}_formatName(...e){return e.filter(e=>!!e).join(", ")}async geocode(e){e=i(this.options,{key:this.options.apiKey,location:e,limit:5,outFormat:"json"}),e=await d(this.options.serviceUrl+"/address",e);return this._parseResults(e)}async reverse(e,t){e=n(this.options,{key:this.options.apiKey,location:e.lat+","+e.lng,outputFormat:"json"}),e=await d(this.options.serviceUrl+"/reverse",e);return this._parseResults(e)}_parseResults(e){return((null==(e=null==(e=e.results)?void 0:e[0])?void 0:e.locations)||[]).map(e=>{var t=new a.LatLng(e.latLng.lat,e.latLng.lng);return{name:this._formatName(e.street,e.adminArea4,e.adminArea3,e.adminArea1),bbox:new a.LatLngBounds(t,t),center:t}})}}class x{constructor(e){s(this,"options",{userId:"",apiKey:"",serviceUrl:"https://neutrinoapi.com/"}),a.Util.setOptions(this,e)}async geocode(e){const t=i(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,address:e.split(/\s+/).join(".")}),s=await d(this.options.serviceUrl+"geocode-address",t);if(!s.locations)return[];s.geometry=s.locations[0];var e=new a.LatLng(s.geometry.latitude,s.geometry.longitude),o=new a.LatLngBounds(e,e);return[{name:s.geometry.address,bbox:o,center:e}]}suggest(e){return this.geocode(e)}async reverse(e,t){var s=n(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,latitude:e.lat,longitude:e.lng}),s=await d(this.options.serviceUrl+"geocode-reverse",s);if(200!==s.status.status||!s.found)return[];var e=new a.LatLng(e.lat,e.lng),o=new a.LatLngBounds(e,e);return[{name:s.address,bbox:o,center:e}]}}class U{constructor(e){s(this,"options",{serviceUrl:"https://nominatim.openstreetmap.org/",htmlTemplate(e){e=e.address;let t;const s=[];return(e.road||e.building)&&s.push("{building} {road} {house_number}"),(e.city||e.town||e.village||e.hamlet)&&(t=0<s.length?"leaflet-control-geocoder-address-detail":"",s.push('<span class="'+t+'">{postcode} {city} {town} {village} {hamlet}</span>')),(e.state||e.country)&&(t=0<s.length?"leaflet-control-geocoder-address-context":"",s.push('<span class="'+t+'">{state} {country}</span>')),u(s.join("<br/>"),e)}}),a.Util.setOptions(this,e||{})}async geocode(e){e=i(this.options,{q:e,limit:5,format:"json",addressdetails:1});return(await d(this.options.serviceUrl+"search",e)).map(e=>{var t=e.boundingbox;return{icon:e.icon,name:e.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(e):void 0,bbox:new a.LatLngBounds([+t[0],+t[2]],[+t[1],+t[3]]),center:new a.LatLng(+e.lat,+e.lon),properties:e}})}async reverse(e,t){e=n(this.options,{lat:e.lat,lon:e.lng,zoom:Math.round(Math.log(t/256)/Math.log(2)),addressdetails:1,format:"json"}),t=await d(this.options.serviceUrl+"reverse",e);if(null==t||!t.lat||null==t||!t.lon)return[];var e=new a.LatLng(+t.lat,+t.lon),s=new a.LatLngBounds(e,e);return[{name:t.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t):void 0,center:e,bbox:s,properties:t}]}}class R{constructor(e){s(this,"options",{}),a.Util.setOptions(this,e)}async geocode(e){try{var t=this.options.OpenLocationCode.decode(e);return[{name:e,center:new a.LatLng(t.latitudeCenter,t.longitudeCenter),bbox:new a.LatLngBounds(new a.LatLng(t.latitudeLo,t.longitudeLo),new a.LatLng(t.latitudeHi,t.longitudeHi))}]}catch(e){return console.warn(e),[]}}async reverse(e,t){try{return[{name:this.options.OpenLocationCode.encode(e.lat,e.lng,this.options.codeLength),center:new a.LatLng(e.lat,e.lng),bbox:new a.LatLngBounds(new a.LatLng(e.lat,e.lng),new a.LatLng(e.lat,e.lng))}]}catch(e){return console.warn(e),[]}}}class E{constructor(e){s(this,"options",{serviceUrl:"https://api.opencagedata.com/geocode/v1/json"}),a.Util.setOptions(this,e)}async geocode(e){e=i(this.options,{key:this.options.apiKey,q:e}),e=await d(this.options.serviceUrl,e);return this._parseResults(e)}suggest(e){return this.geocode(e)}async reverse(e,t){e=n(this.options,{key:this.options.apiKey,q:[e.lat,e.lng].join(",")}),e=await d(this.options.serviceUrl,e);return this._parseResults(e)}_parseResults(e){return(e.results||[]).map(e=>{var t=new a.LatLng(e.geometry.lat,e.geometry.lng),s=e.annotations&&e.annotations.bounds?new a.LatLngBounds(new a.LatLng(e.annotations.bounds.northeast.lat,e.annotations.bounds.northeast.lng),new a.LatLng(e.annotations.bounds.southwest.lat,e.annotations.bounds.southwest.lng)):new a.LatLngBounds(t,t);return{name:e.formatted,bbox:s,center:t,properties:e}})}}class k{constructor(e){s(this,"options",{serviceUrl:"https://api.geocode.earth/v1"}),a.Util.setOptions(this,e)}async geocode(e){e=i(this.options,{api_key:this.options.apiKey,text:e}),e=await d(this.options.serviceUrl+"/search",e);return this._parseResults(e,"bbox")}async suggest(e){e=i(this.options,{api_key:this.options.apiKey,text:e}),e=await d(this.options.serviceUrl+"/autocomplete",e);return this._parseResults(e,"bbox")}async reverse(e,t){e=n(this.options,{api_key:this.options.apiKey,"point.lat":e.lat,"point.lon":e.lng}),e=await d(this.options.serviceUrl+"/reverse",e);return this._parseResults(e,"bounds")}_parseResults(e,i){const r=[];return new a.GeoJSON(e,{pointToLayer(e,t){return new a.CircleMarker(t,{radius:10})},onEachFeature(e,t){const s={};let o,n;t.getBounds?(o=t.getBounds(),n=o.getCenter()):o=t.feature.bbox?(n=t.getLatLng(),new a.LatLngBounds(a.GeoJSON.coordsToLatLng(t.feature.bbox.slice(0,2)),a.GeoJSON.coordsToLatLng(t.feature.bbox.slice(2,4)))):(n=t.getLatLng(),new a.LatLngBounds(n,n)),s.name=t.feature.properties.label,s.center=n,s[i]=o,s.properties=t.feature.properties,r.push(s)}}),r}}function O(e){return new k(e)}var t=k,j=k;class P extends k{constructor(e){super(Object.assign({serviceUrl:"https://api.openrouteservice.org/geocode"},e))}}class B{constructor(e){s(this,"options",{serviceUrl:"https://photon.komoot.io/api/",reverseUrl:"https://photon.komoot.io/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]}),a.Util.setOptions(this,e)}async geocode(e,t){var s;const o=i(this.options,{q:e}),n=null==(s=null==(e=null==t?void 0:t.map)?void 0:e.getCenter)?void 0:s.call(e);n&&(o.lat=n.lat,o.lon=n.lng);t=null==(e=null==(s=null==t?void 0:t.map)?void 0:s.getZoom)?void 0:e.call(s),t&&(o.zoom=t),e=await d(this.options.serviceUrl,o);return this._parseResults(e)}suggest(e){return this.geocode(e)}async reverse(e,t){e=n(this.options,{lat:e.lat,lon:e.lng}),e=await d(this.options.reverseUrl,e);return this._parseResults(e)}_parseResults(e){return(e.features||[]).map(e=>{var t=e.geometry.coordinates,t=new a.LatLng(t[1],t[0]),s=null==(s=e.properties)?void 0:s.extent,s=s?new a.LatLngBounds([s[1],s[0]],[s[3],s[2]]):new a.LatLngBounds(t,t);return{name:this._decodeFeatureName(e),html:this.options.htmlTemplate?this.options.htmlTemplate(e):void 0,center:t,bbox:s,properties:e.properties}})}_decodeFeatureName(s){return(this.options.nameProperties||[]).map(e=>{var t;return null==(t=s.properties)?void 0:t[e]}).filter(e=>!!e).join(", ")}}class K{constructor(e){s(this,"options",{serviceUrl:"https://api.what3words.com/v2/"}),a.Util.setOptions(this,e)}async geocode(e){e=await d(this.options.serviceUrl+"forward",i(this.options,{key:this.options.apiKey,addr:e.split(/\s+/).join(".")}));if(!e.geometry)return[];var t=new a.LatLng(e.geometry.lat,e.geometry.lng),s=new a.LatLngBounds(t,t);return[{name:e.words,bbox:s,center:t}]}suggest(e){return this.geocode(e)}async reverse(e,t){e=await d(this.options.serviceUrl+"reverse",n(this.options,{key:this.options.apiKey,coords:[e.lat,e.lng].join(",")}));if(200!=e.status.status)return[];var s=new a.LatLng(e.geometry.lat,e.geometry.lng),o=new a.LatLngBounds(s,s);return[{name:e.words,bbox:o,center:s}]}}t=Object.freeze(Object.defineProperty({__proto__:null,ArcGis:h,AzureMaps:m,Bing:g,GeocodeEarth:t,Google:v,HERE:L,HEREv2:w,LatLng:y,MapQuest:f,Mapbox:b,Mapzen:j,Neutrino:x,Nominatim:U,OpenCage:E,OpenLocationCode:R,Openrouteservice:P,Pelias:k,Photon:B,What3Words:K,arcgis:function(e){return new h(e)},azure:function(e){return new m(e)},bing:function(e){return new g(e)},geocodeEarth:O,geocodingParams:i,google:function(e){return new v(e)},here:function(e){return new(null!=e&&e.apiKey?w:L)(e)},latLng:function(e){return new y(e)},mapQuest:function(e){return new f(e)},mapbox:function(e){return new b(e)},mapzen:O,neutrino:function(e){return new x(e)},nominatim:function(e){return new U(e)},openLocationCode:function(e){return new R(e)},opencage:function(e){return new E(e)},openrouteservice:function(e){return new P(e)},parseLatLng:_,pelias:O,photon:function(e){return new B(e)},reverseParams:n,what3words:function(e){return new K(e)}},Symbol.toStringTag,{value:"Module"}));class T{constructor(){}}Object.assign(T.prototype,a.Control.prototype),Object.assign(T.prototype,a.Evented.prototype);class C extends T{constructor(e){super(e),s(this,"options",{showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",iconLabel:"Initiate a new search",query:"",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0}),s(this,"_alts"),s(this,"_container"),s(this,"_errorElement"),s(this,"_geocodeMarker"),s(this,"_input"),s(this,"_lastGeocode"),s(this,"_map"),s(this,"_preventBlurCollapse"),s(this,"_requestCount",0),s(this,"_results"),s(this,"_selection"),s(this,"_suggestTimeout"),a.Util.setOptions(this,e),this.options.geocoder||(this.options.geocoder=new U)}addThrobberClass(){this._container.classList.add("leaflet-control-geocoder-throbber")}removeThrobberClass(){this._container.classList.remove("leaflet-control-geocoder-throbber")}onAdd(e){const t="leaflet-control-geocoder",s=a.DomUtil.create("div",t+" leaflet-bar"),o=a.DomUtil.create("button",t+"-icon",s),n=a.DomUtil.create("div",t+"-form",s),i=(this._map=e,this._container=s,o.innerHTML="&nbsp;",o.type="button",o.setAttribute("aria-label",this.options.iconLabel),this._input=a.DomUtil.create("input","",n));return i.type="search",i.value=this.options.query,i.placeholder=this.options.placeholder,a.DomEvent.disableClickPropagation(i),this._errorElement=a.DomUtil.create("div",t+"-form-no-error",s),this._errorElement.innerHTML=this.options.errorMessage,this._alts=a.DomUtil.create("ul",t+"-alternatives leaflet-control-geocoder-alternatives-minimized",s),a.DomEvent.disableClickPropagation(this._alts),a.DomEvent.addListener(i,"keydown",this._keydown,this),null!=(e=this.options.geocoder)&&e.suggest&&a.DomEvent.addListener(i,"input",this._change,this),a.DomEvent.addListener(i,"blur",()=>{this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1}),this.options.collapsed?"click"===this.options.expand?a.DomEvent.addListener(s,"click",e=>{0===e.button&&2!==e.detail&&this._toggle()}):"touch"===this.options.expand?a.DomEvent.addListener(s,a.Browser.touch?"touchstart mousedown":"mousedown",e=>{this._toggle(),e.preventDefault(),e.stopPropagation()},this):(a.DomEvent.addListener(s,"mouseover",this._expand,this),a.DomEvent.addListener(s,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),a.Browser.touch?a.DomEvent.addListener(s,"touchstart",()=>this._geocode()):a.DomEvent.addListener(s,"click",()=>this._geocode())),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),a.DomEvent.disableClickPropagation(s),s}setQuery(e){return this._input.value=e,this}_geocodeResult(e,t){!t&&this.options.showUniqueResult&&1===e.length?this._geocodeResultSelected(e[0]):0<e.length?(this._alts.innerHTML="",this._results=e,this._alts.classList.remove("leaflet-control-geocoder-alternatives-minimized"),this._container.classList.add("leaflet-control-geocoder-options-open"),this._results.forEach((e,t)=>this._alts.appendChild(this._createAlt(e,t)))):(this._container.classList.add("leaflet-control-geocoder-options-error"),this._errorElement.classList.add("leaflet-control-geocoder-error"))}markGeocode(e){e=e.geocode;return this._map.fitBounds(e.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new a.Marker(e.center).bindPopup(e.html||e.name).addTo(this._map).openPopup(),this}async _geocode(e=!1){var t,s,o=this._input.value;!e&&o.length<this.options.queryMinLength||(t=++this._requestCount,this._lastGeocode=o,e||this._clearResults(),this.fire(e?"startsuggest":"startgeocode",{input:o}),s={map:this._map},s=e?await this.options.geocoder.suggest(o,s):await this.options.geocoder.geocode(o,s),t===this._requestCount&&(this.fire(e?"finishsuggest":"finishgeocode",{input:o,results:s}),this._geocodeResult(s,e)))}_geocodeResultSelected(e){this.fire("markgeocode",{geocode:e})}_toggle(){this._container.classList.contains("leaflet-control-geocoder-expanded")?this._collapse():this._expand()}_expand(){this._container.classList.add("leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")}_collapse(){this._container.classList.remove("leaflet-control-geocoder-expanded"),this._alts.classList.add("leaflet-control-geocoder-alternatives-minimized"),this._errorElement.classList.remove("leaflet-control-geocoder-error"),this._container.classList.remove("leaflet-control-geocoder-options-open"),this._container.classList.remove("leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")}_clearResults(){this._alts.classList.add("leaflet-control-geocoder-alternatives-minimized"),this._selection=null,this._errorElement.classList.remove("leaflet-control-geocoder-error"),this._container.classList.remove("leaflet-control-geocoder-options-open"),this._container.classList.remove("leaflet-control-geocoder-options-error")}_createAlt(t,e){const s=a.DomUtil.create("li",""),o=a.DomUtil.create("a","",s),n=this.options.showResultIcons&&t.icon?a.DomUtil.create("img","",o):null,i=t.html?void 0:document.createTextNode(t.name);return n&&(n.src=t.icon),s.setAttribute("data-result-index",String(e)),t.html?o.innerHTML=o.innerHTML+t.html:i&&o.appendChild(i),a.DomEvent.addListener(s,"mousedown touchstart",e=>{this._preventBlurCollapse=!0,a.DomEvent.stop(e),this._geocodeResultSelected(t),a.DomEvent.on(s,"click touchend",()=>{this.options.collapsed?this._collapse():this._clearResults()})},this),s}_keydown(e){var t,s=e=>{this._selection&&(this._selection.classList.remove("leaflet-control-geocoder-selected"),this._selection=this._selection[0<e?"nextSibling":"previousSibling"]),this._selection||(this._selection=this._alts[0<e?"firstChild":"lastChild"]),this._selection&&this._selection.classList.add("leaflet-control-geocoder-selected")};switch(e.key){case"Escape":this.options.collapsed?this._collapse():this._clearResults();break;case"ArrowUp":s(-1);break;case"ArrowDown":s(1);break;case"Enter":this._selection?(t=parseInt(this._selection.getAttribute("data-result-index"),10),this._geocodeResultSelected(this._results[t]),this._clearResults()):this._geocode();break;default:return}a.DomEvent.preventDefault(e)}_change(){var e=this._input.value;e!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),e.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(()=>this._geocode(!0),this.options.suggestTimeout):this._clearResults())}}function S(e){return new C(e)}Object.assign(C,t),Object.assign(a.Control,{Geocoder:C,geocoder:S}),e.Geocoder=C,e.default=C,e.geocoder=S,e.geocoders=t,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});